<!doctype html>
<meta charset=utf-8>
<title>ファイル送信</title>
<meta name=viewport content='width=device-width, initial-scale=1'>
<link href=style.css rel=stylesheet>
<link href=assets/clipboard.css rel=stylesheet>
<link rel='shortcut icon' href=assets/favicon.png>

    <script language="javascript">
      $(function() {
        var droppable = $("#droppable");
 
        // File API が使用できない場合は諦めます.
        if(!window.FileReader) {
          alert("File API がサポートされていません。");
          return false;
        }
 
        // イベントをキャンセルするハンドラです.
        var cancelEvent = function(event) {
            event.preventDefault();
            event.stopPropagation();
            return false;
        }
 
        // dragenter, dragover イベントのデフォルト処理をキャンセルします.
        droppable.bind("dragenter", cancelEvent);
        droppable.bind("dragover", cancelEvent);
 
        // ドロップ時のイベントハンドラを設定します.
        var handleDroppedFile = function(event) {
          // ファイルは複数ドロップされる可能性がありますが, ここでは 1 つ目のファイルを扱います.
          var file = event.originalEvent.dataTransfer.files[0];
 
          // ファイルの内容は FileReader で読み込みます.
          var fileReader = new FileReader();
          fileReader.onload = function(event) {
            // event.target.result に読み込んだファイルの内容が入っています.
            // ドラッグ＆ドロップでファイルアップロードする場合は result の内容を Ajax でサーバに送信しましょう!
            $("#droppable").text("[" + file.name + "]" + event.target.result);
          }
          fileReader.readAsText(file);
 
          // デフォルトの処理をキャンセルします.
          cancelEvent(event);
          return false;
        }
 
        // ドロップ時のイベントハンドラを設定します.
        droppable.bind("drop", handleDroppedFile);
      });
    </script>

<!-- UI based on http://tutorialzine.com/2013/11/javascript-file-encrypter/ -->

<a class='back'></a>

<div id=stage>
  <div id=step1>
    <div class='content'>
      <a class='button send magenta'>準備中</a>
      <small>P2Pを利用してファイル送信します。</small>
            <div id="droppable" style="border: gray solid 1em; padding: 2em;">
      ファイルをドロップしてください。
    </div>
        <br>
      <br>
      <input type=file id=send-input />
    </div>
  </div>
  

 
  <div id=step2>
    <div class='content if-send'>
      <div class="input-group">
        <input type=url class=url upload onClick=this.select() readonly id=connection-id
          ${!state.dashboard.connectionId ? 'disabled' : 'readonly'}
          value="${window.location.href + '#/join/' + state.dashboard.connectionId}"
        >
        <span class="input-group-button">
          <button class="btn" data-clipboard-target=#connection-id>
            <img class="clippy" src=assets/clippy.svg alt="Copy to clipboard">
          </button>
        </span>
      </div>
      <div id=transfer-info>
        ダウンロード中: <span id=active-transfers>0</span> -
        ダウンロード数: <span id=finished-transfers>0</span>
      </div>
    </div>


    <div class='content if-receive'>
      <a class='button receive red'>受信中...</a>
      <!--<small>The download dialog will open automatically.</small>-->
    </div>
  </div>

  <div id=step3>
    <div class='content'>
      <a class='button browse blue' id=downloadLink>再ダウンロード</a>
    </div>
  </div>
</div>

<footer>
</footer>

<script src=bundle.js></script>
